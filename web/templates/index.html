<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seek Bot Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.4.0/dist/full.css"
      rel="stylesheet"
      type="text/css"
    />
    <script
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">

  </head>
  <body class="bg-base-200 min-h-screen">
    <div x-data="seekBot()" x-init="init()" class="container mx-auto p-4">
      <!-- Header -->
      <div class="navbar bg-base-100 rounded-box shadow-lg mb-6">
        <div class="flex-1">
          <h1 class="text-xl font-bold text-primary">‚ö° Seek Bot Dashboard</h1>
        </div>
        <div class="flex-none">
          <div
            class="badge badge-accent badge-lg"
            x-text="status.running ? 'RUNNING' : 'IDLE'"
          ></div>
        </div>
      </div>

      <!-- Status Card -->
      <div class="card bg-base-100 shadow-lg mb-6">
        <div class="card-body">
          <h2 class="card-title text-primary">Bot Status</h2>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="stat">
              <div class="stat-title">Current Task</div>
              <div
                class="stat-value text-sm"
                x-text="status.current_task"
              ></div>
            </div>
            <div class="stat">
              <div class="stat-title">Jobs Found</div>
              <div
                class="stat-value text-accent"
                x-text="status.jobs_found"
              ></div>
            </div>
            <div class="stat">
              <div class="stat-title">Applied</div>
              <div
                class="stat-value text-success"
                x-text="status.applications_sent"
              ></div>
            </div>
            <div class="stat">
              <div class="stat-title">Errors</div>
              <div class="stat-value text-error" x-text="status.errors"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Control Panel -->
      <div class="card bg-base-100 shadow-lg mb-6">
        <div class="card-body">
          <h2 class="card-title text-primary">Control Panel</h2>
          <div class="flex gap-4 mt-4">
            <button
              class="btn btn-success"
              :disabled="status.running"
              @click="startBot()"
              :class="{ 'loading': startingBot }"
            >
              <span x-show="!startingBot">üöÄ Start Bot</span>
              <span x-show="startingBot">Starting...</span>
            </button>
            <button
              class="btn btn-error"
              :disabled="!status.running"
              @click="stopBot()"
              :class="{ 'loading': stoppingBot }"
            >
              <span x-show="!stoppingBot">‚èπÔ∏è Stop Bot</span>
              <span x-show="stoppingBot">Stopping...</span>
            </button>
            <button class="btn btn-info" @click="refreshStatus()">
              üîÑ Refresh
            </button>
          </div>
        </div>
      </div>

      <!-- Configuration Form -->
      <div class="card bg-base-100 shadow-lg mb-6">
        <div class="card-body">
          <h2 class="card-title text-primary">Configuration</h2>

          <form @submit.prevent="updateConfig()">

            <!-- Job Preferences -->
            <div class="divider">Job Preferences</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Keywords (comma separated)</span>
                </label>
                <input
                  type="text"
                  class="input input-bordered"
                  x-model="keywordsText"
                  placeholder="python, backend, api"
                />
              </div>
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Locations (comma separated)</span>
                </label>
                <input
                  type="text"
                  class="input input-bordered"
                  x-model="locationsText"
                  placeholder="Sydney, Melbourne, Remote"
                />
              </div>
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Minimum Salary</span>
                </label>
                <input
                  type="number"
                  class="input input-bordered"
                  x-model="config.job_preferences.salary_min"
                  placeholder="80000"
                />
              </div>
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Maximum Salary</span>
                </label>
                <input
                  type="number"
                  class="input input-bordered"
                  x-model="config.job_preferences.salary_max"
                  placeholder="150000"
                />
              </div>
            </div>

            <!-- Application Settings -->
            <div class="divider">Application Settings</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="form-control">
                <label class="label cursor-pointer">
                  <span class="label-text">Auto Apply</span>
                  <input
                    type="checkbox"
                    class="checkbox checkbox-primary"
                    x-model="config.application_settings.auto_apply"
                  />
                </label>
              </div>
              <div class="form-control">
                <label class="label">
                  <span class="label-text">Max Applications per Day</span>
                </label>
                <input
                  type="number"
                  class="input input-bordered"
                  x-model="config.application_settings.max_applications_per_day"
                  min="1"
                  max="50"
                />
              </div>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">Cover Letter Template</span>
              </label>
              <textarea
                class="textarea textarea-bordered h-24"
                x-model="config.application_settings.cover_letter_template"
                placeholder="Dear Hiring Manager..."
              ></textarea>
            </div>

            <!-- Agreement -->
            <div class="divider">Legal Agreement</div>
            <div class="form-control">
              <label class="label cursor-pointer">
                <span class="label-text">
                  ‚ö†Ô∏è I understand that using this bot may violate Seek's Terms
                  of Service. I assume all responsibility for my account and any
                  consequences.
                </span>
                <input
                  type="checkbox"
                  class="checkbox checkbox-warning"
                  x-model="config.user.agreement_accepted"
                  required
                />
              </label>
            </div>

            <!-- Submit Button -->
            <div class="form-control mt-6">
              <button
                type="submit"
                class="btn btn-primary"
                :class="{ 'loading': savingConfig }"
              >
                <span x-show="!savingConfig">üíæ Save Configuration</span>
                <span x-show="savingConfig">Saving...</span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Tabs for Data Display -->
      <div class="card bg-base-100 shadow-lg">
        <div class="card-body">
          <div class="tabs tabs-boxed">
            <a
              class="tab"
              :class="{ 'tab-active': activeTab === 'jobs' }"
              @click="activeTab = 'jobs'"
            >
              Jobs (<span x-text="jobs.length"></span>)
            </a>
            <a
              class="tab"
              :class="{ 'tab-active': activeTab === 'applied' }"
              @click="activeTab = 'applied'"
            >
              Applied (<span x-text="applied.length"></span>)
            </a>
            <a
              class="tab"
              :class="{ 'tab-active': activeTab === 'logs' }"
              @click="activeTab = 'logs'"
            >
              Logs (<span x-text="logs.length"></span>)
            </a>
          </div>

          <!-- Jobs Tab -->
          <div x-show="activeTab === 'jobs'" class="mt-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold">Scraped Jobs</h3>
              <button class="btn btn-sm btn-error" @click="clearData('jobs')">
                Clear Jobs
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="table table-zebra">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Company</th>
                    <th>Location</th>
                    <th>Salary</th>
                    <th>Posted</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="job in jobs.slice(0, 10)" :key="job.id">
                    <tr>
                      <td x-text="job.title"></td>
                      <td x-text="job.company"></td>
                      <td x-text="job.location"></td>
                      <td x-text="job.salary || 'Not specified'"></td>
                      <td x-text="job.posted_date"></td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Applied Tab -->
          <div x-show="activeTab === 'applied'" class="mt-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold">Applied Jobs</h3>
              <button
                class="btn btn-sm btn-error"
                @click="clearData('applied')"
              >
                Clear Applied
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="table table-zebra">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Company</th>
                    <th>Applied Date</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-for="job in applied.slice(0, 10)" :key="job.id">
                    <tr>
                      <td x-text="job.title"></td>
                      <td x-text="job.company"></td>
                      <td x-text="job.applied_date"></td>
                      <td>
                        <div class="badge badge-success">Applied</div>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Logs Tab -->
          <div x-show="activeTab === 'logs'" class="mt-4">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-lg font-semibold">Application Logs</h3>
              <button class="btn btn-sm btn-error" @click="clearData('logs')">
                Clear Logs
              </button>
            </div>
            <div class="overflow-x-auto max-h-96">
              <template
                x-for="log in logs.slice(-50).reverse()"
                :key="log.timestamp"
              >
                <div class="chat chat-start">
                  <div class="chat-header">
                    <span x-text="log.timestamp"></span>
                    <div
                      class="badge badge-xs"
                      :class="{
                                        'badge-error': log.level === 'ERROR',
                                        'badge-warning': log.level === 'WARNING',
                                        'badge-info': log.level === 'INFO'
                                    }"
                      x-text="log.level"
                    ></div>
                  </div>
                  <div class="chat-bubble text-sm" x-text="log.message"></div>
                </div>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>    

    <script src="/static/app.js"></script>
  </body>
</html>
